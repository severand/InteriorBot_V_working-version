# üî¨ SCREENS_MAP_V1 - –ü–û–õ–ù–´–ô –ú–ò–ö–†–û–°–ö–û–ü–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó INTERIOR BOT

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 24.12.2025 09:15  
**–í–µ—Ä—Å–∏—è:** V1.0  
**–ü—Ä–æ–µ–∫—Ç:** InteriorBot_V_working-version (github.com/severand/InteriorBot_V_working-version)  
**–°—Ç–∞—Ç—É—Å –∞–Ω–∞–ª–∏–∑–∞:** ‚úÖ –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –≠–¢–ê–ü–û–í 1-8 (–ö–û–ü–ò–†–û–í–ê–¢–¨ –ò –í–´–ü–û–õ–ù–Ø–¢–¨)

---

## –í–í–ï–î–ï–ù–ò–ï

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç **–º–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã UI/UX –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏** –ø—Ä–æ–µ–∫—Ç–∞ InteriorBot.  
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞: `bot/` ‚Äî –∫–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞.

**–ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:** `bot/handlers/` (user_start.py, creation.py, admin.py, payment.py, referral.py, fallback.py, webhook.py)
- **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:** `bot/keyboards/` (inline.py, admin_kb.py)
- **–°–æ—Å—Ç–æ—è–Ω–∏—è FSM:** `bot/states/fsm.py`
- **–¢–µ–∫—Å—Ç—ã —ç–∫—Ä–∞–Ω–æ–≤:** `bot/utils/texts.py`, `bot/utils/admin_texts.py`
- **–ù–∞–≤–∏–≥–∞—Ü–∏—è:** `bot/utils/navigation.py` (–µ–¥–∏–Ω–æ–µ –º–µ–Ω—é Single Menu Pattern)
- **–ë–î:** `bot/database/db.py` (–≥–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ FSM + –ë–î)

---

## –≠–¢–ê–ü 1: –ê–ù–ê–õ–ò–ó –°–¢–†–£–ö–¢–£–†–´ –ü–†–û–ï–ö–¢–ê ‚úÖ

### –ö–æ—Ä–Ω–µ–≤–∞—è –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
bot/
‚îú‚îÄ‚îÄ handlers/           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback'–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ user_start.py   # /start, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é, –ø—Ä–æ—Ñ–∏–ª—å, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ creation.py     # –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞ (—Ñ–æ—Ç–æ ‚Üí —Å—Ç–∏–ª—å ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ admin.py        # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –±–∞–ª–∞–Ω—Å–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ payment.py      # –û–ø–ª–∞—Ç–∞, –ø–∞–∫–µ—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ referral.py     # –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –≤—ã–ø–ª–∞—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ fallback.py     # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îî‚îÄ‚îÄ webhook.py      # –í–µ–±—Ö—É–∫ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –æ—Ç API
‚îú‚îÄ‚îÄ keyboards/          # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (inline)
‚îÇ   ‚îú‚îÄ‚îÄ inline.py       # –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ admin_kb.py     # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ states/             # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ fsm.py          # CreationStates, AdminStates, ReferralStates
‚îú‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ texts.py        # –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —ç–∫—Ä–∞–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ admin_texts.py  # –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ navigation.py   # –ï–¥–∏–Ω–æ–µ –º–µ–Ω—é (edit_menu, show_main_menu)
‚îÇ   ‚îî‚îÄ‚îÄ helpers.py      # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ database/           # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ db.py           # –†–∞–±–æ—Ç–∞ —Å –ë–î (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–Ω—é, –±–∞–ª–∞–Ω—Å, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
‚îú‚îÄ‚îÄ services/           # –°–µ—Ä–≤–∏—Å—ã (API, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π)
‚îú‚îÄ‚îÄ data/               # –î–∞–Ω–Ω—ã–µ (—Ñ–æ—Ç–æ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞
‚îú‚îÄ‚îÄ loader.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è router'–æ–≤
‚îú‚îÄ‚îÄ main.py             # –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
‚îî‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (aiogram, sqlite3)
```

---

## –≠–¢–ê–ü 2: –ê–ù–ê–õ–ò–ó FSM –ò STATES ‚úÖ

### –ü–æ–ª–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ StatesGroup –∏ State'–æ–≤

| # | StatesGroup | State | –û–ø–∏—Å–∞–Ω–∏–µ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ |
|---|---|---|---|---|
| **CREATION STATES** | | | | |
| 1 | CreationStates | `waiting_for_photo` | –û–∂–∏–¥–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∫–æ–º–Ω–∞—Ç—ã/—Ñ–∞—Å–∞–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `creation.py::photo_handler()` |
| 2 | CreationStates | `what_is_in_photo` | **–ù–û–í–û–ï:** –í—ã–±–æ—Ä –º–µ–∂–¥—É –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–º –∏ —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–æ–º (–∏–ª–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∫–æ–º–Ω–∞—Ç–∞) | `creation.py::process_what_is_in_photo()` |
| 3 | CreationStates | `choose_room` | –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–æ–º–Ω–∞—Ç—ã (—Å–ø–∞–ª—å–Ω—è, –∫—É—Ö–Ω—è, –≥–æ—Å—Ç–∏–Ω–∞—è –∏ —Ç.–¥.) | `creation.py::process_room_choice()` |
| 4 | CreationStates | `choose_style` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è –¥–∏–∑–∞–π–Ω–∞ (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –º–∏–Ω–∏–º–∞–ª–∏–∑–º, —Å–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∏–π –∏ —Ç.–¥.) | `creation.py::process_style_choice()` |
| 5 | CreationStates | `waiting_for_room_description` | **–ù–û–í–û–ï:** –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è "–î—Ä—É–≥–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è" | `creation.py::waiting_for_room_description_handler()` |
| 6 | CreationStates | `waiting_for_exterior_prompt` | **–ù–û–í–û–ï:** –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–∞ (–¥–æ–º/—É—á–∞—Å—Ç–æ–∫) | `creation.py::waiting_for_exterior_prompt_handler()` |
| **ADMIN STATES** | | | | |
| 7 | AdminStates | `waiting_for_user_id` | –û–∂–∏–¥–∞–Ω–∏–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–∏—Å–∫–∞/—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | `admin.py::process_user_id_input()` |
| 8 | AdminStates | `waiting_for_search` | –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–ø–æ ID, username, —Ä–µ—Ñ.–∫–æ–¥—É) | `admin.py::process_search_input()` |
| 9 | AdminStates | `adding_balance` | –û–∂–∏–¥–∞–Ω–∏–µ —Å—É–º–º—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é | `admin.py::process_balance_add()` |
| 10 | AdminStates | `removing_balance` | –û–∂–∏–¥–∞–Ω–∏–µ —Å—É–º–º—ã –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π | `admin.py::process_balance_remove()` |
| 11 | AdminStates | `setting_balance` | –û–∂–∏–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ | `admin.py::process_balance_set()` |
| **REFERRAL STATES** | | | | |
| 12 | ReferralStates | `entering_payout_amount` | –í–≤–æ–¥ —Å—É–º–º—ã –¥–ª—è –≤—ã–ø–ª–∞—Ç—ã —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤ | `referral.py::process_payout_amount()` |
| 13 | ReferralStates | `entering_exchange_amount` | –í–≤–æ–¥ –∫–æ–ª-–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –¥–ª—è –æ–±–º–µ–Ω–∞ –Ω–∞ —Ä—É–±–ª–∏ | `referral.py::process_exchange_amount()` |
| 14 | ReferralStates | `entering_card_number` | –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã –¥–ª—è –≤—ã–ø–ª–∞—Ç—ã | `referral.py::process_card_number()` |
| 15 | ReferralStates | `entering_yoomoney` | –í–≤–æ–¥ YooMoney –∫–æ—à–µ–ª—å–∫–∞ | `referral.py::process_yoomoney()` |
| 16 | ReferralStates | `entering_phone` | –í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –°–ë–ü (–±—ã—Å—Ç—Ä—ã–µ –ø–ª–∞—Ç–µ–∂–∏) | `referral.py::process_phone()` |
| 17 | ReferralStates | `entering_other_method` | –í–≤–æ–¥ –¥—Ä—É–≥–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –≤—ã–ø–ª–∞—Ç—ã | `referral.py::process_other_method()` |

**üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- **–í—Å–µ–≥–æ StatesGroup:** 4 –∫–ª–∞—Å—Å–∞
- **–í—Å–µ–≥–æ State'–æ–≤:** 17 —Å–æ—Å—Ç–æ—è–Ω–∏–π
- **CreationStates:** 6 (–ø—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
- **AdminStates:** 5 (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
- **ReferralStates:** 6 (—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)
- **OtherStates:** 0 (–∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ)

---

## –≠–¢–ê–ü 3: –ê–ù–ê–õ–ò–ó –¢–ï–ö–°–¢–û–í –≠–ö–†–ê–ù–û–í ‚úÖ

### –¢–∞–±–ª–∏—Ü–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

| # | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | –§–∞–π–ª | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | –≠–∫—Ä–∞–Ω |
|---|---|---|---|---|---|
| 1 | `START_TEXT` | ‚Äî | texts.py | `user_start.py::cmd_start()`, `show_main_menu()` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| 2 | `MAIN_MENU_TEXT` | ‚Äî | texts.py | `show_main_menu()` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–ø–æ—Å–ª–µ –ø–µ—Ä–µ—Ö–æ–¥–∞) |
| 3 | `PROFILE_TEXT` | `{balance}`, `{reg_date}` | texts.py | `user_start.py::show_profile()` | –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç |
| 4 | `PAYMENT_SUCCESS_TEXT` | `{balance}` | texts.py | `payment.py::payment_success_handler()` | –£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ |
| 5 | `PAYMENT_ERROR_TEXT` | ‚Äî | texts.py | `payment.py::payment_error_handler()` | –û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã |
| 6 | `UPLOAD_PHOTO_TEXT` | ‚Äî | texts.py | `user_start.py::start_creation()` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ |
| 7 | `PHOTO_SAVED_TEXT` | ‚Äî | texts.py | `creation.py::photo_handler()` | –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ (–ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω "–ß—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ") |
| 8 | `CHOOSE_ROOM_TEXT` | ‚Äî | texts.py | `creation.py::process_what_is_in_photo()` | –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∫–æ–º–Ω–∞—Ç—ã |
| 9 | `CHOOSE_STYLE_TEXT` | ‚Äî | texts.py | `creation.py::process_room_choice()` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è –¥–∏–∑–∞–π–Ω–∞ |
| 10 | `NO_BALANCE_TEXT` | ‚Äî | texts.py | `creation.py::photo_handler()`, `user_start.py::buy_generations_handler()` | –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –±–∞–ª–∞–Ω—Å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è |
| 11 | `TOO_MANY_PHOTOS_TEXT` | ‚Äî | texts.py | `creation.py::photo_handler()` | –û—à–∏–±–∫–∞: –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –∑–∞ —Ä–∞–∑ |
| 12 | `PAYMENT_CREATED` | `{amount}`, `{tokens}` | texts.py | `payment.py::payment_created_handler()` | –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã |
| 13 | `WHAT_IS_IN_PHOTO_TEXT` | ‚Äî | texts.py | `creation.py::photo_handler()` | –í—ã–±–æ—Ä: –∏–Ω—Ç–µ—Ä—å–µ—Ä –∏–ª–∏ —ç–∫—Å—Ç–µ—Ä—å–µ—Ä (–ù–û–í–û–ï) |
| 14 | `EXTERIOR_HOUSE_PROMPT_TEXT` | ‚Äî | texts.py | `creation.py::process_what_is_in_photo()` (callback `scene_house_exterior`) | –í–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —Ñ–∞—Å–∞–¥–∞ –¥–æ–º–∞ |
| 15 | `EXTERIOR_PLOT_PROMPT_TEXT` | ‚Äî | texts.py | `creation.py::process_what_is_in_photo()` (callback `scene_plot_exterior`) | –í–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —É—á–∞—Å—Ç–∫–∞ |
| 16 | `ROOM_DESCRIPTION_PROMPT_TEXT` | ‚Äî | texts.py | `creation.py::process_what_is_in_photo()` (callback `room_other`) | –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è –¥—Ä—É–≥–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è |

### –¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

| # | –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ | –§–∞–π–ª | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|---|---|
| 1 | `ADMIN_NO_ACCESS_TEXT` | admin_texts.py | `admin.py` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞) | –ó–∞–ø—Ä–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (–Ω–µ –∞–¥–º–∏–Ω) |
| 2 | `ADMIN_MAIN_TEXT` | admin_texts.py | `admin.py::admin_panel()` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ |
| 3 | `ADMIN_STATS_TEXT` | admin_texts.py | `admin.py::admin_stats()` | –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã |
| 4 | `ADMIN_USER_CARD_TEXT` | admin_texts.py | `admin.py::show_user_card()` | –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| 5 | `ADMIN_USER_NOT_FOUND_TEXT` | admin_texts.py | `admin.py::admin_find_user()` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω |
| 6 | `BALANCE_MANAGEMENT_MAIN_TEXT` | admin_texts.py | `admin.py::balance_management()` | –ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–º |
| 7 | `BALANCE_USER_FOUND_TEXT` | admin_texts.py | `admin.py::balance_user_found()` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| 8 | `BALANCE_WAITING_AMOUNT_ADD_TEXT` | admin_texts.py | `admin.py::waiting_for_balance_add()` | –ó–∞–ø—Ä–æ—Å —Å—É–º–º—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è |
| 9 | `BALANCE_WAITING_AMOUNT_REMOVE_TEXT` | admin_texts.py | `admin.py::waiting_for_balance_remove()` | –ó–∞–ø—Ä–æ—Å —Å—É–º–º—ã –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è |
| 10 | `BALANCE_WAITING_AMOUNT_SET_TEXT` | admin_texts.py | `admin.py::waiting_for_balance_set()` | –ó–∞–ø—Ä–æ—Å —Å—É–º–º—ã –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ |
| 11-16 | `BALANCE_CONFIRM_*_TEXT` | admin_texts.py | `admin.py::confirm_*_operation()` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| 17-19 | `BALANCE_SUCCESS_*_TEXT` | admin_texts.py | `admin.py::*_operation_success()` | –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| 20 | `BALANCE_ERROR_INSUFFICIENT_TEXT` | admin_texts.py | `admin.py::check_balance()` | –û—à–∏–±–∫–∞: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ |
| 21 | `BALANCE_ERROR_INVALID_AMOUNT_TEXT` | admin_texts.py | `admin.py::validate_amount()` | –û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ |

**üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤:**
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ç–µ–∫—Å—Ç—ã:** 16 –∫–æ–Ω—Å—Ç–∞–Ω—Ç
- **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:** 21 –∫–æ–Ω—Å—Ç–∞–Ω—Ç
- **–í—Å–µ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç:** 37
- **–ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π:** PROFILE_TEXT, PAYMENT_SUCCESS_TEXT, PAYMENT_CREATED, –∏ –≤—Å–µ BALANCE_* –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

---

## –≠–¢–ê–ü 4: –ê–ù–ê–õ–ò–ó –ö–õ–ê–í–ò–ê–¢–£–† (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –≠–¢–ê–ü) ‚úÖ

### –§—É–Ω–∫—Ü–∏—è 1: `get_main_menu_keyboard(is_admin: bool = False)`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 70-86)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —Å —É—Å–ª–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–æ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** ‚Äî

**–ö–Ω–æ–ø–∫–∏:**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≠–∫—Ä–∞–Ω | –°—Ç–∞—Ç—É—Å |
|---|---|---|---|---|
| üé® –°–æ–∑–¥–∞—Ç—å –¥–∏–∑–∞–π–Ω | `create_design` | `user_start.py::start_creation()` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (UPLOAD_PHOTO) | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | `show_profile` | `user_start.py::show_profile()` | –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (PROFILE) | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |
| ‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | `admin_panel` | `admin.py::admin_panel()` | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (ADMIN_MAIN) | ‚úÖ –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ (if is_admin) |

**Adjust:** `.adjust(1)` ‚Äî 1 –∫–Ω–æ–ø–∫–∞ –≤ —Ä—è–¥ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ)

**–ö–æ–¥:**
```python
def get_main_menu_keyboard(is_admin: bool = False) -> InlineKeyboardMarkup:
    builder = InlineKeyboardBuilder()
    builder.row(InlineKeyboardButton(text="üé® –°–æ–∑–¥–∞—Ç—å –¥–∏–∑–∞–π–Ω", callback_data="create_design"))
    builder.row(InlineKeyboardButton(text="üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç", callback_data="show_profile"))
    if is_admin:
        builder.row(InlineKeyboardButton(text="‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å", callback_data="admin_panel"))
    builder.adjust(1)
    return builder.as_markup()
```

---

### –§—É–Ω–∫—Ü–∏—è 2: `get_upload_photo_keyboard()`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 89-94)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Å –∫–Ω–æ–ø–∫–æ–π –≤–æ–∑–≤—Ä–∞—Ç–∞

**–ö–Ω–æ–ø–∫–∏:**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≠–∫—Ä–∞–Ω | –°—Ç–∞—Ç—É—Å |
|---|---|---|---|---|
| üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `main_menu` | `user_start.py::back_to_main_menu()` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (MAIN_MENU) | ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞ |

---

### –§—É–Ω–∫—Ü–∏—è 3: `get_what_is_in_photo_keyboard()` ‚≠êÔ∏è –ù–û–í–ê–Ø

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 98-144)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –≠–∫—Ä–∞–Ω "–ß—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ" ‚Äî –≤—ã–±–æ—Ä –º–µ–∂–¥—É –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–º –∏ —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–æ–º (–ù–û–í–û–ï 2025-12-08)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ (–ø–æ 2 –≤ —Ä—è–¥):**
- –†—è–¥ 1: –î–æ–º (—Ñ–∞—Å–∞–¥) | –£—á–∞—Å—Ç–æ–∫ / –¥–≤–æ—Ä [–≠–ö–°–¢–ï–†–¨–ï–†] ‚Äî **–ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–´ –≤ v1**
- –†—è–¥ 2-5: 8 –∫–æ–º–Ω–∞—Ç –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞ [–ò–ù–¢–ï–†–¨–ï–†]
- –†—è–¥ 6: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

**–ö–Ω–æ–ø–∫–∏:**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≠–∫—Ä–∞–Ω | –°—Ç–∞—Ç—É—Å |
|---|---|---|---|
| üõã –ì–æ—Å—Ç–∏–Ω–∞—è | `room_living_room` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üçΩ –ö—É—Ö–Ω—è | `room_kitchen` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üõè –°–ø–∞–ª—å–Ω—è | `room_bedroom` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üë∂ –î–µ—Ç—Å–∫–∞—è | `room_nursery` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üöø –í–∞–Ω–Ω–∞—è / —Å–∞–Ω—É–∑–µ–ª | `room_bathroom_full` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üíº –ö–∞–±–∏–Ω–µ—Ç | `room_home_office` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üõã –ü—Ä–∏—Ö–æ–∂–∞—è | `Entryway` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üçΩ –ì–∞—Ä–¥–µ—Ä–æ–±–Ω–∞—è | `wardrobe` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üîç –î—Ä—É–≥–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ | `room_other` | –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–º–µ—â–µ–Ω–∏—è (ROOM_DESC) | ‚úÖ |
| üè° –ö–æ–º–Ω–∞—Ç–∞ —Ü–µ–ª–∏–∫–æ–º | `room_studio` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE) | ‚úÖ |
| üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `main_menu` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (MAIN_MENU) | ‚úÖ |

**Adjust:** `.adjust(2, 2, 2, 2, 2, 1)` ‚Äî –ø–æ 2 –≤ —Ä—è–¥, –ø–æ—Å–ª–µ–¥–Ω—è—è –∫–Ω–æ–ø–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ä—è–¥—É

---

### –§—É–Ω–∫—Ü–∏—è 4: `get_room_keyboard()`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 147-159)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í—ã–±–æ—Ä –∫–æ–º–Ω–∞—Ç—ã (–ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–ù–û: –∫–Ω–æ–ø–∫–∞ "–û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ" –≤ v1)

**–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `ROOM_TYPES` (10 –∫–æ–º–Ω–∞—Ç)

**–ö–Ω–æ–ø–∫–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ):**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ |
|---|---|---|
| –ì–æ—Å—Ç–∏–Ω–∞—è | `room_living_room` | `creation.py::process_room_choice()` |
| –°–ø–∞–ª—å–Ω—è | `room_bedroom` | `creation.py::process_room_choice()` |
| –ö—É—Ö–Ω—è | `room_kitchen` | `creation.py::process_room_choice()` |
| –°—Ç–æ–ª–æ–≤–∞—è | `room_dining_room` | `creation.py::process_room_choice()` |
| –ö–∞–±–∏–Ω–µ—Ç | `room_home_office` | `creation.py::process_room_choice()` |
| –ü—Ä–∏—Ö–æ–∂–∞—è | `room_Entryway` | `creation.py::process_room_choice()` |
| –í–∞–Ω–Ω–∞—è | `room_bathroom_full` | `creation.py::process_room_choice()` |
| –°–∞–Ω—É–∑–µ–ª | `room_toilet` | `creation.py::process_room_choice()` |
| –ì–∞—Ä–¥–µ—Ä–æ–±–Ω–∞—è | `room_wardrobe` | `creation.py::process_room_choice()` |
| –î–µ—Ç—Å–∫–∞—è (–º–∞–ª—ã—à) | `room_nursery` | `creation.py::process_room_choice()` |
| üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `main_menu` | `user_start.py::back_to_main_menu()` |

**Adjust:** `.adjust(2)` ‚Äî –ø–æ 2 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥

---

### –§—É–Ω–∫—Ü–∏—è 5: `get_style_keyboard()`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 162-179)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í—ã–±–æ—Ä —Å—Ç–∏–ª—è –¥–∏–∑–∞–π–Ω–∞ (16 —Å—Ç–∏–ª–µ–π –ø–æ 2 –≤ —Ä—è–¥)

**–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `STYLE_TYPES` (13 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å—Ç–∏–ª–µ–π)

**–ö–Ω–æ–ø–∫–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ):**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data |
|---|---|
| –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π | `style_modern` |
| –ú–∏–Ω–∏–º–∞–ª–∏–∑–º | `style_minimalist` |
| –°–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∏–π | `style_scandinavian` |
| –ò–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω—ã–π (–ª–æ—Ñ—Ç) | `style_industrial` |
| –†—É—Å—Ç–∏–∫ | `style_rustic` |
| –î–∂–∞–ø–∞–Ω–¥–∏ | `style_japandi` |
| –ë–æ—Ö–æ / –≠–∫–ª–µ–∫—Ç–∏–∫–∞ | `style_boho` |
| Mid-century / –≤–∏–Ω—Ç–∞–∂ | `style_midcentury` |
| –ê—Ä—Ç-–¥–µ–∫–æ | `style_artdeco` |
| –ü—Ä–∏–±—Ä–µ–∂–Ω—ã–π | `style_coastal` |
| –û—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏–π –ú–æ–¥–µ—Ä–Ω | `style_Organic Modern` |
| –õ–æ—Ñ—Ç | `style_Loft` |

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –°—Ç–∞—Ç—É—Å |
|---|---|---|
| üßΩ –û—á–∏—Å—Ç–∏—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ | `clear_space_confirm` | ‚úÖ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ v1) |
| ‚¨ÖÔ∏è –í—ã–±—Ä–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É | `back_to_room` | ‚úÖ |
| üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `main_menu` | ‚úÖ |

**Adjust:** –°—Ç–∏–ª–∏ –ø–æ 2 –≤ —Ä—è–¥, –∑–∞—Ç–µ–º 3 –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

### –§—É–Ω–∫—Ü–∏—è 6: `get_post_generation_keyboard(show_continue_editing: bool = False)`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 182-209)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞)

**–õ–æ–≥–∏–∫–∞:**
- `show_continue_editing = True` ‚Üí –†–£–ß–ù–û–ô –ü–†–û–ú–ü–¢ (–¥–æ–º, —É—á–∞—Å—Ç–æ–∫, –¥—Ä—É–≥–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ)
- `show_continue_editing = False` ‚Üí –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–û –°–¢–ò–õ–Æ

**–ö–Ω–æ–ø–∫–∏ (—É—Å–ª–æ–≤–Ω—ã–µ):**

**–†–µ–∂–∏–º 1: –†—É—á–Ω–æ–π –ø—Ä–æ–º–ø—Ç (show_continue_editing=True)**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –ü–µ—Ä–µ—Ö–æ–¥ |
|---|---|---|
| ‚úèÔ∏è –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | `continue_editing` | –≠–∫—Ä–∞–Ω —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| üì∏ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ | `create_design` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ |
| üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `main_menu` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |

**–†–µ–∂–∏–º 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∏–ª—é (show_continue_editing=False)**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –ü–µ—Ä–µ—Ö–æ–¥ |
|---|---|---|
| üîÑ –î—Ä—É–≥–æ–π —Å—Ç–∏–ª—å | `change_style` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è |
| üì∏ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ | `create_design` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ |
| üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `main_menu` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |

---

### –§—É–Ω–∫—Ü–∏—è 7: `get_clear_space_confirm_keyboard()`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 212-224)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—á–∏—Å—Ç–∫–∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (–°–û–•–†–ê–ù–ï–ù–ê –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

**–ö–Ω–æ–ø–∫–∏:**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –°—Ç–∞—Ç—É—Å |
|---|---|---|
| ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å | `clear_space_execute` | ‚ö†Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ v1 |
| ‚ùå –û—Ç–º–µ–Ω–∞ | `clear_space_cancel` | ‚ö†Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ v1 |

---

### –§—É–Ω–∫—Ü–∏—è 8: `get_profile_keyboard()`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 227-245)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (5 –∫–Ω–æ–ø–æ–∫)

**–ö–Ω–æ–ø–∫–∏:**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –ü–µ—Ä–µ—Ö–æ–¥ | –°—Ç–∞—Ç—É—Å |
|---|---|---|---|---|
| üí≥ –°—Ç–æ–∏–º–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–π | `buy_generations` | `user_start.py::buy_generations_handler()` | –û–ø–ª–∞—Ç–∞ (PAYMENT) | ‚úÖ |
| üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | `show_support` | `user_start.py::show_support()` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (SUPPORT) | ‚úÖ |
| üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `main_menu` | `user_start.py::back_to_main_menu()` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | ‚úÖ |

**–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏:**
- üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (`show_statistics`)
- üéÅ –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (`show_referral_program`)

---

### –§—É–Ω–∫—Ü–∏—è 9: `get_payment_keyboard()`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 248-255)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í—ã–±–æ—Ä –ø–∞–∫–µ—Ç–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏)

**–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `PACKAGES = {10: 190, 25: 450, 50: 850}`

**–ö–Ω–æ–ø–∫–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ):**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | callback_data | –ü–µ—Ä–µ—Ö–æ–¥ |
|---|---|---|
| 10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π - 190 —Ä—É–±. | `pay_10_190` | –°—Å—ã–ª–∫–∞ –æ–ø–ª–∞—Ç—ã (Yookassa) |
| 25 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π - 450 —Ä—É–±. | `pay_25_450` | –°—Å—ã–ª–∫–∞ –æ–ø–ª–∞—Ç—ã (Yookassa) |
| 50 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π - 850 —Ä—É–±. | `pay_50_850` | –°—Å—ã–ª–∫–∞ –æ–ø–ª–∞—Ç—ã (Yookassa) |
| ‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –ø—Ä–æ—Ñ–∏–ª—å | `show_profile` | –ü—Ä–æ—Ñ–∏–ª—å |

**Adjust:** `.adjust(2)` ‚Äî –ø–æ 2 –∫–Ω–æ–ø–∫–∏ –≤ —Ä—è–¥

---

### –§—É–Ω–∫—Ü–∏—è 10: `get_payment_check_keyboard(url: str)`

**–§–∞–π–ª:** `bot/keyboards/inline.py` (—Å—Ç—Ä–æ–∫–∏ 257-264)

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–ø–ª–∞—Ç–µ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø–ª–∞—Ç–µ–∂–∞

**–ö–Ω–æ–ø–∫–∏:**

| –¢–µ–∫—Å—Ç –ö–Ω–æ–ø–∫–∏ | –¢–∏–ø | –î–µ–π—Å—Ç–≤–∏–µ | –ü–µ—Ä–µ—Ö–æ–¥ |
|---|---|---|---|
| üí∞ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ | URL button | –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `url` (Yookassa) | –í–Ω–µ—à–Ω–∏–π —Å–∞–π—Ç |
| ‚¨ÖÔ∏è –ù–∞–∑–∞–¥ | callback | `show_profile` | –ü—Ä–æ—Ñ–∏–ª—å |

---

### –ê–¥–º–∏–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (bot/keyboards/admin_kb.py)

| –§—É–Ω–∫—Ü–∏—è | –ö–Ω–æ–ø–∫–∏ | –î–µ–π—Å—Ç–≤–∏–µ | –°—Ç–∞—Ç—É—Å |
|---|---|---|---|
| `get_admin_main_menu()` | 8 –∫–Ω–æ–ø–æ–∫ | –ú–µ–Ω—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø–ª–∞—Ç–µ–∂–∏, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ç.–¥.) | ‚úÖ |
| `get_admin_settings_menu()` | 7 –∫–Ω–æ–ø–æ–∫ | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–±–∞–ª–∞–Ω—Å, –ø–∞–∫–µ—Ç—ã, —Å–∫–∏–¥–∫–∏, –±–æ–Ω—É—Å—ã, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) | ‚úÖ |
| `get_back_to_admin_menu()` | 1 –∫–Ω–æ–ø–∫–∞ | –í–æ–∑–≤—Ä–∞—Ç –≤ –∞–¥–º–∏–Ω-–º–µ–Ω—é | ‚úÖ |
| `get_back_to_settings()` | 1 –∫–Ω–æ–ø–∫–∞ | –í–æ–∑–≤—Ä–∞—Ç –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | ‚úÖ |
| `get_users_list_keyboard(current_page, total_pages)` | –ü–∞–≥–∏–Ω–∞—Ü–∏—è | –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º | ‚úÖ |
| `get_balance_main_keyboard(user_id)` | 5 –∫–Ω–æ–ø–æ–∫ | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º (–¥–æ–±–∞–≤–∏—Ç—å, —Å–ø–∏—Å–∞—Ç—å, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å) | ‚úÖ |
| `get_balance_confirm_keyboard()` | 2 –∫–Ω–æ–ø–∫–∏ | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ / –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º | ‚úÖ |
| `get_balance_cancel_keyboard()` | 1 –∫–Ω–æ–ø–∫–∞ | –û—Ç–º–µ–Ω–∞ –≤–≤–æ–¥–∞ | ‚úÖ |

**üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä:**
- **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã:** 10 —Ñ—É–Ω–∫—Ü–∏–π
- **–ê–¥–º–∏–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã:** 8 —Ñ—É–Ω–∫—Ü–∏–π
- **–í—Å–µ–≥–æ –∫–Ω–æ–ø–æ–∫:** 37+ (–≤–∫–ª—é—á–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ)
- **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–Ω–æ–ø–∫–∏:** ROOM_TYPES (10), STYLE_TYPES (13), PACKAGES (3)

---

## –≠–¢–ê–ü 5: –ê–ù–ê–õ–ò–ó –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í (–°–ê–ú–´–ô –í–ê–ñ–ù–´–ô –≠–¢–ê–ü) ‚úÖ

### –§–∞–π–ª: bot/handlers/user_start.py

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 1: `cmd_start()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.message(F.text.startswith("/start"))`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::cmd_start`

**FSM State:** None (–Ω–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è)

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π –∏–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
2. –ï—Å–ª–∏ –Ω–æ–≤—ã–π ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (user_id, reg_date, –±–∞–ª–∞–Ω—Å)
3. –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ‚Üí –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ
4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ menu_message_id –≤ FSM (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–ª—è –µ–¥–∏–Ω–æ–≥–æ –º–µ–Ω—é)
5. –í—ã–∑–æ–≤ `show_main_menu()` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** `START_TEXT` (—Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º —á–µ—Ä–µ–∑ `add_balance_to_text()`)

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_main_menu_keyboard(is_admin=user_id in admins)`

**–ü–µ—Ä–µ—Ö–æ–¥:** –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (MAIN_MENU)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 2: `back_to_main_menu()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "main_menu")`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::back_to_main_menu`

**FSM State:** None (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ callback'–∞
2. –í—ã–∑–æ–≤ `show_main_menu()` –∏–∑ navigation.py
3. –°–±—Ä–æ—Å FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è (–æ—Å—Ç–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ menu_message_id)
4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ–Ω—é (Single Menu Pattern)

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** `START_TEXT` + –±–∞–ª–∞–Ω—Å

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_main_menu_keyboard(is_admin=...)`

**–ü–µ—Ä–µ—Ö–æ–¥:** –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (MAIN_MENU)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 3: `show_profile()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "show_profile")`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::show_profile`

**FSM State:** None

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î (balance, reg_date)
2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ PROFILE_TEXT —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. –í—ã–∑–æ–≤ `edit_menu()` –∏–∑ navigation.py –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–Ω—é
4. –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –ø—Ä–æ—Ñ–∏–ª—è

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** `PROFILE_TEXT` (–∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è: {balance}, {reg_date})

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_profile_keyboard()`

**–ü–µ—Ä–µ—Ö–æ–¥:** –ü—Ä–æ—Ñ–∏–ª—å (PROFILE)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 4: `buy_generations_handler()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "buy_generations")`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::buy_generations_handler`

**FSM State:** None

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –ø–∞–∫–µ—Ç–∞–º–∏
3. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã —Å –≤—ã–±–æ—Ä–æ–º –ø–∞–∫–µ—Ç–æ–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
4. –ü–µ—Ä–µ—Ö–æ–¥ –∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É payment.py

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** –¢–µ–∫—Å—Ç —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø–∞–∫–µ—Ç–æ–≤ –∏ —Ü–µ–Ω–∞–º–∏

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_payment_keyboard()`

**–ü–µ—Ä–µ—Ö–æ–¥:** –í—ã–±–æ—Ä –ø–∞–∫–µ—Ç–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã (PAYMENT)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 5: `start_creation()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "create_design")`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::start_creation`

**FSM State:** `CreationStates.waiting_for_photo`

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å—Ç—å –ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
2. –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å = 0 ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ NO_BALANCE_TEXT
3. –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å > 0 ‚Üí —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è waiting_for_photo
4. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
5. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é —á–µ—Ä–µ–∑ edit_menu()

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** `UPLOAD_PHOTO_TEXT` –∏–ª–∏ `NO_BALANCE_TEXT`

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_upload_photo_keyboard()`

**–ü–µ—Ä–µ—Ö–æ–¥:** –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (UPLOAD_PHOTO) –∏–ª–∏ –ü—Ä–æ—Ñ–∏–ª—å (–µ—Å–ª–∏ –Ω–µ—Ç –±–∞–ª–∞–Ω—Å–∞)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 6: `show_statistics()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "show_statistics")`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::show_statistics`

**FSM State:** None

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∫–æ–ª-–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π, –∏–∑–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏, –∫–æ–º–Ω–∞—Ç—ã)
2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** –í–æ–∑–≤—Ä–∞—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å

**–ü–µ—Ä–µ—Ö–æ–¥:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (STATISTICS)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 7: `show_referral_program()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "show_referral_program")`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::show_referral_program`

**FSM State:** None

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ-—Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ (–ø—Ä–∏–≥–ª–∞—à–µ–Ω–æ, –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ)
3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
4. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ + —Å—Å—ã–ª–∫–∞

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏ (–≤—ã–ø–ª–∞—Ç–∞, –æ–±–º–µ–Ω)

**–ü–µ—Ä–µ—Ö–æ–¥:** –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (REFERRAL)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 8: `show_support()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "show_support")`

**–ü—É—Ç—å:** `bot/handlers/user_start.py::show_support`

**FSM State:** None

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏–∑ config.py
2. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ø—Ä–æ—Ñ–∏–ª—å

**–ü–µ—Ä–µ—Ö–æ–¥:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ (SUPPORT)

---

### –§–∞–π–ª: bot/handlers/creation.py

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 1: `photo_handler()` ‚≠êÔ∏è –ö–õ–Æ–ß–ï–í–û–ô

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.message(StateFilter(CreationStates.waiting_for_photo))`

**–ü—É—Ç—å:** `bot/handlers/creation.py::photo_handler`

**FSM State:** `CreationStates.waiting_for_photo` (–≤—Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ)

**–õ–æ–≥–∏–∫–∞:**
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ç–æ (–Ω–µ —Ç–µ–∫—Å—Ç, –Ω–µ —Ñ–∞–π–ª)
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞:** –ï—Å–ª–∏ balance <= 0 ‚Üí NO_BALANCE_TEXT
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:** –ï—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ (–∞–ª—å–±–æ–º) ‚Üí TOO_MANY_PHOTOS_TEXT
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ:** –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ file_id –≤ FSM state
5. **–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω:** –£—Å—Ç–∞–Ω–æ–≤–∫–∞ state = `CreationStates.what_is_in_photo`
6. **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–Ω—é:** –í—ã–∑–æ–≤ `update_menu_after_photo()` —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** `PHOTO_SAVED_TEXT` ‚Üí `WHAT_IS_IN_PHOTO_TEXT` (–≤—ã–±–æ—Ä: –∏–Ω—Ç–µ—Ä—å–µ—Ä –∏–ª–∏ —ç–∫—Å—Ç–µ—Ä—å–µ—Ä)

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_what_is_in_photo_keyboard()`

**–ü–µ—Ä–µ—Ö–æ–¥:** –≠–∫—Ä–∞–Ω "–ß—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ" (WHAT_IS_IN_PHOTO)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 2: `process_what_is_in_photo()` ‚≠êÔ∏è –ù–û–í–´–ô (2025-12-08)

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data.in_(["scene_house_exterior", "scene_plot_exterior", "room_*", ...]))`

**–ü—É—Ç—å:** `bot/handlers/creation.py::process_what_is_in_photo`

**FSM State:** `CreationStates.what_is_in_photo`

**–õ–æ–≥–∏–∫–∞ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç callback_data):**

**–í–∞—Ä–∏–∞–Ω—Ç 1: –≠–∫—Å—Ç–µ—Ä—å–µ—Ä (–¥–æ–º)**
- callback_data = `scene_house_exterior`
- State ‚Üí `waiting_for_exterior_prompt`
- –¢–µ–∫—Å—Ç ‚Üí `EXTERIOR_HOUSE_PROMPT_TEXT`
- –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–í–∞—Ä–∏–∞–Ω—Ç 2: –≠–∫—Å—Ç–µ—Ä—å–µ—Ä (—É—á–∞—Å—Ç–æ–∫)**
- callback_data = `scene_plot_exterior`
- State ‚Üí `waiting_for_exterior_prompt`
- –¢–µ–∫—Å—Ç ‚Üí `EXTERIOR_PLOT_PROMPT_TEXT`
- –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ò–Ω—Ç–µ—Ä—å–µ—Ä (–≤—ã–±—Ä–∞–Ω–Ω–∞—è –∫–æ–º–Ω–∞—Ç–∞)**
- callback_data = `room_*` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `room_living_room`, `room_kitchen`)
- State ‚Üí `CreationStates.choose_style`
- –¢–µ–∫—Å—Ç ‚Üí `CHOOSE_STYLE_TEXT`
- –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ ‚Üí `get_style_keyboard()`
- –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—ã–±–æ—Ä —Å—Ç–∏–ª—è

**–í–∞—Ä–∏–∞–Ω—Ç 4: –î—Ä—É–≥–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ**
- callback_data = `room_other`
- State ‚Üí `waiting_for_room_description`
- –¢–µ–∫—Å—Ç ‚Üí `ROOM_DESCRIPTION_PROMPT_TEXT`
- –û–∂–∏–¥–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è

**–ü–µ—Ä–µ—Ö–æ–¥:** 
- –≠–∫—Å—Ç–µ—Ä—å–µ—Ä ‚Üí –í–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞ (EXTERIOR_PROMPT)
- –ò–Ω—Ç–µ—Ä—å–µ—Ä ‚Üí –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE)
- –î—Ä—É–≥–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ ‚Üí –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è (ROOM_DESC)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 3: `process_room_choice()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data.startswith("room_"))`

**–ü—É—Ç—å:** `bot/handlers/creation.py::process_room_choice`

**FSM State:** `CreationStates.choose_room`

**–õ–æ–≥–∏–∫–∞:**
1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–æ–º–Ω–∞—Ç—ã –∏–∑ callback_data
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ FSM state: `room_type`
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ state = `CreationStates.choose_style`
4. –û—Ç–ø—Ä–∞–≤–∫–∞ —ç–∫—Ä–∞–Ω–∞ –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª—è

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** `CHOOSE_STYLE_TEXT`

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_style_keyboard()`

**–ü–µ—Ä–µ—Ö–æ–¥:** –í—ã–±–æ—Ä —Å—Ç–∏–ª—è (CHOOSE_STYLE)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 4: `process_style_choice()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data.startswith("style_"))`

**–ü—É—Ç—å:** `bot/handlers/creation.py::process_style_choice`

**FSM State:** `CreationStates.choose_style`

**–õ–æ–≥–∏–∫–∞:**
1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ç–∏–ª—è –∏–∑ callback_data
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ FSM state: `style_type`
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ (–±–∞–ª–∞–Ω—Å > 0?)
4. –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å OK:
   - –í—ã–∑–æ–≤ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã post-generation
5. –ï—Å–ª–∏ –±–∞–ª–∞–Ω—Å = 0:
   - –û—Ç–ø—Ä–∞–≤–∫–∞ NO_BALANCE_TEXT

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_post_generation_keyboard(show_continue_editing=False)`

**–ü–µ—Ä–µ—Ö–æ–¥:** –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (POST_GENERATION)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 5: `waiting_for_exterior_prompt_handler()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.message(StateFilter(CreationStates.waiting_for_exterior_prompt))`

**–ü—É—Ç—å:** `bot/handlers/creation.py::waiting_for_exterior_prompt_handler`

**FSM State:** `CreationStates.waiting_for_exterior_prompt`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –≤ FSM state: `exterior_prompt`
4. –í—ã–∑–æ–≤ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ –ø—Ä–æ–º–ø—Ç—É
5. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
6. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_post_generation_keyboard(show_continue_editing=True)`

**–ü–µ—Ä–µ—Ö–æ–¥:** –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (POST_GENERATION) —Å –æ–ø—Ü–∏–µ–π —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ 6: `waiting_for_room_description_handler()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.message(StateFilter(CreationStates.waiting_for_room_description))`

**–ü—É—Ç—å:** `bot/handlers/creation.py::waiting_for_room_description_handler`

**FSM State:** `CreationStates.waiting_for_room_description`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–º–µ—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –≤ FSM state: `room_description`
4. –í—ã–∑–æ–≤ API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
5. –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
6. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** –°–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_post_generation_keyboard(show_continue_editing=True)`

**–ü–µ—Ä–µ—Ö–æ–¥:** –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (POST_GENERATION)

---

### –§–∞–π–ª: bot/handlers/user_start.py (—á–∞—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤)

**–î—Ä—É–≥–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, —É–ø–æ–º—è–Ω—É—Ç—ã–µ –≤—ã—à–µ, –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ:**
- `back_to_main_menu()` ‚Äî callback_data: `main_menu`
- `show_profile()` ‚Äî callback_data: `show_profile`
- `buy_generations_handler()` ‚Äî callback_data: `buy_generations`
- `start_creation()` ‚Äî callback_data: `create_design`
- –∏ –¥—Ä—É–≥–∏–µ

---

### –§–∞–π–ª: bot/handlers/payment.py

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `pay_handler()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data.startswith("pay_"))`

**–ü—É—Ç—å:** `bot/handlers/payment.py::pay_handler`

**–õ–æ–≥–∏–∫–∞:**
1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ tokens –∏ price –∏–∑ callback_data (—Ñ–æ—Ä–º–∞—Ç: `pay_10_190`)
2. –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ —á–µ—Ä–µ–∑ Yookassa API
3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –¥–ª—è –æ–ø–ª–∞—Ç—ã
4. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Å—Å—ã–ª–∫–æ–π –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π

**–¢–µ–∫—Å—Ç —ç–∫—Ä–∞–Ω–∞:** `PAYMENT_CREATED` (–∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è: {amount}, {tokens})

**–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞:** `get_payment_check_keyboard(url=payment_url)`

**–ü–µ—Ä–µ—Ö–æ–¥:** –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã (PAYMENT_LINK)

---

### –§–∞–π–ª: bot/handlers/admin.py

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `admin_panel()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "admin_panel")`

**–õ–æ–≥–∏–∫–∞:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω? (user_id in admins)
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí ADMIN_NO_ACCESS_TEXT
3. –ï—Å–ª–∏ –¥–∞ ‚Üí ADMIN_MAIN_TEXT —Å –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
4. –û—Ç–ø—Ä–∞–≤–∫–∞ get_admin_main_menu()

**–ü–µ—Ä–µ—Ö–æ–¥:** –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (ADMIN_MAIN)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `admin_stats()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "admin_stats")`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã –∏–∑ –ë–î
2. –ò–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è ADMIN_STATS_TEXT —Å –¥–∞–Ω–Ω—ã–º–∏:
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–∑–∞ —Å–µ–≥–æ–¥–Ω—è, –Ω–µ–¥–µ–ª—é, –≤—Å–µ–≥–æ)
   - –î–æ—Ö–æ–¥
   - –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã –∏ —Å—Ç–∏–ª–∏

**–ü–µ—Ä–µ—Ö–æ–¥:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (ADMIN_STATS)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `admin_find_user()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "admin_find_user")`

**FSM State:** `AdminStates.waiting_for_search`

**–õ–æ–≥–∏–∫–∞:**
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ state –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: "–í–≤–µ–¥–∏—Ç–µ ID, username –∏–ª–∏ —Ä–µ—Ñ-–∫–æ–¥"
3. –û–∂–∏–¥–∞–Ω–∏–µ input'–∞ –æ—Ç –∞–¥–º–∏–Ω–∞

**–ü–µ—Ä–µ—Ö–æ–¥:** –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (ADMIN_SEARCH)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `admin_search_handler()` (message handler)

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.message(StateFilter(AdminStates.waiting_for_search))`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
2. –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î (–ø–æ ID, username, —Ä–µ—Ñ-–∫–æ–¥—É)
3. –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω ‚Üí ADMIN_USER_CARD_TEXT —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí ADMIN_USER_NOT_FOUND_TEXT

**–ü–µ—Ä–µ—Ö–æ–¥:** –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –æ—à–∏–±–∫–∞ (ADMIN_USER_CARD –∏–ª–∏ ADMIN_NOT_FOUND)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `balance_management()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data.startswith("settings_balance"))`

**–õ–æ–≥–∏–∫–∞:**
1. –û—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–º
2. –û—Ç–ø—Ä–∞–≤–∫–∞ get_balance_main_keyboard(user_id)

**–ü–µ—Ä–µ—Ö–æ–¥:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º (BALANCE_MANAGEMENT)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `balance_add_handler()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data.startswith("balance_add_"))`

**FSM State:** `AdminStates.adding_balance`

**–õ–æ–≥–∏–∫–∞:**
1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ state –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ —Å—É–º–º—ã
2. –û—Ç–ø—Ä–∞–≤–∫–∞ BALANCE_WAITING_AMOUNT_ADD_TEXT
3. –û–∂–∏–¥–∞–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ input'–∞

**–ü–µ—Ä–µ—Ö–æ–¥:** –í–≤–æ–¥ —Å—É–º–º—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è (BALANCE_ADD_AMOUNT)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `balance_add_amount_handler()` (message handler)

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.message(StateFilter(AdminStates.adding_balance))`

**–õ–æ–≥–∏–∫–∞:**
1. –í–∞–ª–∏–¥–∞—Ü–∏—è input'–∞ (—á–∏—Å–ª–æ, > 0)
2. –ï—Å–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Üí BALANCE_ERROR_INVALID_AMOUNT_TEXT
3. –ï—Å–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ‚Üí —Ä–∞—Å—á–µ—Ç –Ω–æ–≤–æ–≥–æ –±–∞–ª–∞–Ω—Å–∞
4. –û—Ç–ø—Ä–∞–≤–∫–∞ BALANCE_CONFIRM_ADD_TEXT —Å –¥–µ—Ç–∞–ª—è–º–∏
5. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

**–ü–µ—Ä–µ—Ö–æ–¥:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (BALANCE_CONFIRM)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `balance_confirm_operation()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "balance_confirm_operation")`

**–õ–æ–≥–∏–∫–∞:**
1. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –ë–î (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—Å–ø–∏—Å–∞–Ω–∏–µ/—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π)
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –û—Ç–ø—Ä–∞–≤–∫–∞ BALANCE_SUCCESS_ADD_TEXT (–∏–ª–∏ SUCCESS_REMOVE/SUCCESS_SET)
4. –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è

**–ü–µ—Ä–µ—Ö–æ–¥:** –£—Å–ø–µ—Ö (BALANCE_SUCCESS)

---

### –§–∞–π–ª: bot/handlers/referral.py

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `show_referral_info()`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—Ñ-—Å—Å—ã–ª–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–∑ –ë–î)
2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: —Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–æ, —Å–∫–æ–ª—å–∫–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ
3. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π –∏ —Å—Å—ã–ª–∫–æ–π
4. –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: –≤—ã–ø–ª–∞—Ç–∞, –æ–±–º–µ–Ω –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

**–ü–µ—Ä–µ—Ö–æ–¥:** –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (REFERRAL_PROGRAM)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `referral_payout()`

**–î–µ–∫–æ—Ä–∞—Ç–æ—Ä:** `@router.callback_query(F.data == "referral_payout")`

**FSM State:** `ReferralStates.entering_payout_amount`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ —Ä–µ—Ñ–±–æ–Ω—É—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è: "–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–ø–ª–∞—Ç—ã"
3. –û–∂–∏–¥–∞–Ω–∏–µ input'–∞

**–ü–µ—Ä–µ—Ö–æ–¥:** –í–≤–æ–¥ —Å—É–º–º—ã –≤—ã–ø–ª–∞—Ç—ã (REFERRAL_PAYOUT_AMOUNT)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `referral_payout_amount_handler()` (message handler)

**–õ–æ–≥–∏–∫–∞:**
1. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö —Ä–µ—Ñ–±–æ–Ω—É—Å–æ–≤
3. –ó–∞–ø—Ä–æ—Å —Å–ø–æ—Å–æ–±–∞ –≤—ã–ø–ª–∞—Ç—ã (–∫–∞—Ä—Ç–∞, YooMoney, –°–ë–ü)
4. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≤—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞

**–ü–µ—Ä–µ—Ö–æ–¥:** –í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –≤—ã–ø–ª–∞—Ç—ã (REFERRAL_METHOD)

---

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫: `referral_payout_method()`

**–õ–æ–≥–∏–∫–∞:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –≤—ã–ø–ª–∞—Ç—ã –∏–∑ callback_data
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ FSM state:
   - `entering_card_number` ‚Üí –≤–≤–æ–¥ –Ω–æ–º–µ—Ä–∞ –∫–∞—Ä—Ç—ã
   - `entering_yoomoney` ‚Üí –≤–≤–æ–¥ YooMoney
   - `entering_phone` ‚Üí –≤–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è –°–ë–ü
   - `entering_other_method` ‚Üí –≤–≤–æ–¥ –ø—Ä–æ—á–µ–≥–æ

**–ü–µ—Ä–µ—Ö–æ–¥:** –í–≤–æ–¥ –¥–µ—Ç–∞–ª–µ–π —Å–ø–æ—Å–æ–±–∞ –≤—ã–ø–ª–∞—Ç—ã (REFERRAL_PAYMENT_DETAILS)

---

---

## –≠–¢–ê–ü 6: –ê–ù–ê–õ–ò–ó –≠–ö–†–ê–ù–û–í (SCREENS) ‚úÖ

### –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤

| # | –ö–æ–¥ –≠–∫—Ä–∞–Ω–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ | –ì–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è | FSM State | –¢–µ–∫—Å—Ç | –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ | –ö–Ω–æ–ø–∫–∏ ‚Üí –ü–µ—Ä–µ—Ö–æ–¥—ã |
|---|---|---|---|---|---|---|---|
| 1 | `MAIN_MENU` | –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é | `user_start.py::cmd_start()`, `back_to_main_menu()` | None | `START_TEXT` + –±–∞–ª–∞–Ω—Å | `get_main_menu_keyboard()` | [üé® –°–æ–∑–¥–∞—Ç—å –¥–∏–∑–∞–π–Ω‚ÜíUPLOAD_PHOTO], [üë§ –ü—Ä–æ—Ñ–∏–ª—å‚ÜíPROFILE], [‚öôÔ∏è –ê–¥–º–∏–Ω‚ÜíADMIN_MAIN] |
| 2 | `UPLOAD_PHOTO` | –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ | `user_start.py::start_creation()` | `CreationStates.waiting_for_photo` | `UPLOAD_PHOTO_TEXT` | `get_upload_photo_keyboard()` | [üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é‚ÜíMAIN_MENU] |
| 3 | `WHAT_IS_IN_PHOTO` | –ß—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ (–ù–æ–≤–æ–µ) | `creation.py::photo_handler()` | `CreationStates.what_is_in_photo` | `WHAT_IS_IN_PHOTO_TEXT` | `get_what_is_in_photo_keyboard()` | [–ö–æ–º–Ω–∞—Ç—ã‚ÜíCHOOSE_STYLE], [–î—Ä—É–≥–æ–µ‚ÜíROOM_DESC], [–î–æ–º/–£—á–∞—Å—Ç–æ–∫‚ÜíEXTERIOR_PROMPT], [üè†‚ÜíMAIN_MENU] |
| 4 | `CHOOSE_ROOM` | –í—ã–±–æ—Ä –∫–æ–º–Ω–∞—Ç—ã | `creation.py::process_what_is_in_photo()` (—Å—Ç–∞—Ä—ã–π –ø–æ—Ç–æ–∫) | `CreationStates.choose_room` | `CHOOSE_ROOM_TEXT` | `get_room_keyboard()` | [–ö–æ–º–Ω–∞—Ç–∞‚ÜíCHOOSE_STYLE], [üè†‚ÜíMAIN_MENU] |
| 5 | `CHOOSE_STYLE` | –í—ã–±–æ—Ä —Å—Ç–∏–ª—è –¥–∏–∑–∞–π–Ω–∞ | `creation.py::process_what_is_in_photo()` (–¥–ª—è –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞) | `CreationStates.choose_style` | `CHOOSE_STYLE_TEXT` | `get_style_keyboard()` | [–°—Ç–∏–ª—å‚ÜíPOST_GENERATION], [‚¨ÖÔ∏è –ö –∫–æ–º–Ω–∞—Ç–µ‚ÜíCHOOSE_ROOM], [üè†‚ÜíMAIN_MENU] |
| 6 | `ROOM_DESC` | –í–≤–æ–¥ –æ–ø–∏—Å–∞–Ω–∏—è –ø–æ–º–µ—â–µ–Ω–∏—è | `creation.py::process_what_is_in_photo()` (callback `room_other`) | `CreationStates.waiting_for_room_description` | `ROOM_DESCRIPTION_PROMPT_TEXT` | `get_upload_photo_keyboard()` | [Text input‚ÜíPOST_GENERATION], [üè†‚ÜíMAIN_MENU] |
| 7 | `EXTERIOR_PROMPT` | –í–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–∞ | `creation.py::process_what_is_in_photo()` (callback `scene_house_exterior` –∏–ª–∏ `scene_plot_exterior`) | `CreationStates.waiting_for_exterior_prompt` | `EXTERIOR_HOUSE_PROMPT_TEXT` –∏–ª–∏ `EXTERIOR_PLOT_PROMPT_TEXT` | `get_upload_photo_keyboard()` | [Text input‚ÜíPOST_GENERATION], [üè†‚ÜíMAIN_MENU] |
| 8 | `POST_GENERATION` | –ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ | `creation.py::process_style_choice()`, `waiting_for_exterior_prompt_handler()`, `waiting_for_room_description_handler()` | None | –°–æ–æ–±—â–µ–Ω–∏–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º | `get_post_generation_keyboard(show_continue_editing)` | [‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å‚ÜíEDIT_SCREEN], [üîÑ –°—Ç–∏–ª—å‚ÜíCHOOSE_STYLE], [üì∏ –ù–æ–≤–æ–µ‚ÜíUPLOAD_PHOTO], [üè†‚ÜíMAIN_MENU] |
| 9 | `PROFILE` | –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç | `user_start.py::show_profile()` | None | `PROFILE_TEXT` | `get_profile_keyboard()` | [üí≥ –ö—É–ø–∏—Ç—å‚ÜíPAYMENT], [üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞‚ÜíSUPPORT], [üè†‚ÜíMAIN_MENU] |
| 10 | `PAYMENT` | –í—ã–±–æ—Ä –ø–∞–∫–µ—Ç–∞ –æ–ø–ª–∞—Ç—ã | `user_start.py::buy_generations_handler()` | None | –ü–∞–∫–µ—Ç—ã –∏ —Ü–µ–Ω—ã | `get_payment_keyboard()` | [10/25/50 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π‚ÜíPAYMENT_LINK], [‚¨ÖÔ∏è –ù–∞–∑–∞–¥‚ÜíPROFILE] |
| 11 | `PAYMENT_LINK` | –°—Å—ã–ª–∫–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã | `payment.py::pay_handler()` | None | `PAYMENT_CREATED` | `get_payment_check_keyboard(url)` | [üí∞ –ü–µ—Ä–µ–π—Ç–∏‚ÜíYookassa], [‚¨ÖÔ∏è –ù–∞–∑–∞–¥‚ÜíPROFILE] |
| 12 | `SUPPORT` | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | `user_start.py::show_support()` | None | –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ | –í–æ–∑–≤—Ä–∞—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å | [‚¨ÖÔ∏è –ù–∞–∑–∞–¥‚ÜíPROFILE] |
| 13 | `STATISTICS` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | `user_start.py::show_statistics()` | None | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | –í–æ–∑–≤—Ä–∞—Ç –≤ –ø—Ä–æ—Ñ–∏–ª—å | [‚¨ÖÔ∏è –ù–∞–∑–∞–¥‚ÜíPROFILE] |
| 14 | `REFERRAL_PROGRAM` | –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ | `user_start.py::show_referral_program()` | None | –†–µ—Ñ-—Å—Å—ã–ª–∫–∞ + —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª–∞–º–∏ | [üí∞ –í—ã–ø–ª–∞—Ç–∞‚ÜíREFERRAL_PAYOUT], [üîÑ –û–±–º–µ–Ω‚ÜíREFERRAL_EXCHANGE], [‚¨ÖÔ∏è –ù–∞–∑–∞–¥‚ÜíPROFILE] |
| **–ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨** | | | | | | | |
| 15 | `ADMIN_MAIN` | –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (–≥–ª–∞–≤–Ω–∞—è) | `admin.py::admin_panel()` | None | `ADMIN_MAIN_TEXT` | `get_admin_main_menu()` | [üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞‚ÜíADMIN_STATS], [üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏‚ÜíADMIN_USERS], [üîç –ü–æ–∏—Å–∫‚ÜíADMIN_SEARCH], [üí∞ –ü–ª–∞—Ç–µ–∂–∏‚ÜíADMIN_PAYMENTS], [üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è‚ÜíADMIN_NOTIFICATIONS], [üåê –ò—Å—Ç–æ—á–Ω–∏–∫–∏‚ÜíADMIN_SOURCES], [‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏‚ÜíADMIN_SETTINGS], [üè†‚ÜíMAIN_MENU] |
| 16 | `ADMIN_STATS` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã | `admin.py::admin_stats()` | None | `ADMIN_STATS_TEXT` | –í–æ–∑–≤—Ä–∞—Ç –≤ –∞–¥–º–∏–Ω-–º–µ–Ω—é | [‚¨ÖÔ∏è –ù–∞–∑–∞–¥‚ÜíADMIN_MAIN] |
| 17 | `ADMIN_SEARCH` | –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `admin.py::admin_find_user()` | `AdminStates.waiting_for_search` | "–í–≤–µ–¥–∏—Ç–µ ID/username/—Ä–µ—Ñ-–∫–æ–¥" | ‚Äî | [Text input‚ÜíADMIN_USER_CARD –∏–ª–∏ ADMIN_NOT_FOUND] |
| 18 | `ADMIN_USER_CARD` | –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `admin.py::search_handler()` | None | `ADMIN_USER_CARD_TEXT` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º | [üí∞ –ë–∞–ª–∞–Ω—Å‚ÜíBALANCE_MANAGEMENT], [üè†‚ÜíADMIN_MAIN] |
| 19 | `ADMIN_SETTINGS` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ | `admin.py::admin_settings()` | None | "–í—ã–±–µ—Ä–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä" | `get_admin_settings_menu()` | [üí∞ –ë–∞–ª–∞–Ω—Å‚ÜíBALANCE_MANAGEMENT], [üì¶ –ü–∞–∫–µ—Ç—ã‚ÜíPACKAGES_SETTINGS], [üéÅ –°–∫–∏–¥–∫–∏‚ÜíDISCOUNTS_SETTINGS], –∏ —Ç.–¥. |
| 20 | `BALANCE_MANAGEMENT` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `admin.py::balance_management()` | None | `BALANCE_MANAGEMENT_MAIN_TEXT` | `get_balance_main_keyboard(user_id)` | [‚ûï –î–æ–±–∞–≤–∏—Ç—å‚ÜíBALANCE_ADD], [‚ûñ –°–ø–∏—Å–∞—Ç—å‚ÜíBALANCE_REMOVE], [üîÑ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å‚ÜíBALANCE_SET] |
| 21 | `BALANCE_ADD` | –í–≤–æ–¥ —Å—É–º–º—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è | `admin.py::balance_add_handler()` | `AdminStates.adding_balance` | `BALANCE_WAITING_AMOUNT_ADD_TEXT` | ‚Äî | [Number input‚ÜíBALANCE_CONFIRM] |
| 22 | `BALANCE_CONFIRM` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–∞–ª–∞–Ω—Å–∞ | `admin.py::balance_confirm()` | None | `BALANCE_CONFIRM_ADD_TEXT` (–∏–ª–∏ REMOVE/SET) | `get_balance_confirm_keyboard()` | [‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å‚ÜíBALANCE_SUCCESS], [‚ùå –û—Ç–º–µ–Ω–∞‚ÜíBALANCE_MANAGEMENT] |
| 23 | `BALANCE_SUCCESS` | –£—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ | `admin.py::balance_operation_success()` | None | `BALANCE_SUCCESS_ADD_TEXT` (–∏–ª–∏ REMOVE/SET) | –í–æ–∑–≤—Ä–∞—Ç –≤ –∞–¥–º–∏–Ω-–º–µ–Ω—é | [‚¨ÖÔ∏è –ù–∞–∑–∞–¥‚ÜíADMIN_SETTINGS] |

**üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–∫—Ä–∞–Ω–æ–≤:**
- **–í—Å–µ–≥–æ —ç–∫—Ä–∞–Ω–æ–≤:** 23
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —ç–∫—Ä–∞–Ω—ã:** 14
- **–ê–¥–º–∏–Ω-—ç–∫—Ä–∞–Ω—ã:** 9
- **–≠–∫—Ä–∞–Ω—ã —Å FSM State:** 11
- **–≠–∫—Ä–∞–Ω—ã –±–µ–∑ FSM State:** 12

---

## –≠–¢–ê–ü 7: –ê–ù–ê–õ–ò–ó –°–í–Ø–ó–ï–ô –ò –ü–û–¢–û–ö–û–í ‚úÖ

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ (User Flows)

#### –ü–û–¢–û–ö 1: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞ –ø–æ —Å—Ç–∏–ª—é

```
MAIN_MENU
   ‚Üì (callback: create_design)
   ‚Üì [–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞]
UPLOAD_PHOTO (State: waiting_for_photo)
   ‚Üì (—Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ)
WHAT_IS_IN_PHOTO (State: what_is_in_photo)
   ‚îú‚Üí (callback: room_living_room / room_bedroom / room_kitchen / ...)
   ‚îÇ   ‚Üì
   ‚îÇ   CHOOSE_STYLE (State: choose_style)
   ‚îÇ   ‚Üì (callback: style_modern / style_scandinavian / ...)
   ‚îÇ   ‚Üì [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∏–ª—é + API]
   ‚îÇ   ‚Üì
   ‚îÇ   POST_GENERATION (show_continue_editing=False)
   ‚îÇ   ‚îú‚Üí [üîÑ –î—Ä—É–≥–æ–π —Å—Ç–∏–ª—å] ‚Üí CHOOSE_STYLE
   ‚îÇ   ‚îú‚Üí [üì∏ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ] ‚Üí UPLOAD_PHOTO
   ‚îÇ   ‚îî‚Üí [üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é] ‚Üí MAIN_MENU
   ‚îÇ
   ‚îî‚Üí (callback: room_other)
       ‚Üì
       ROOM_DESC (State: waiting_for_room_description)
       ‚Üì (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)
       ‚Üì [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é]
       ‚Üì
       POST_GENERATION (show_continue_editing=True)
       ‚îú‚Üí [‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å] ‚Üí EDIT_SCREEN
       ‚îú‚Üí [üì∏ –ù–æ–≤–æ–µ —Ñ–æ—Ç–æ] ‚Üí UPLOAD_PHOTO
       ‚îî‚Üí [üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é] ‚Üí MAIN_MENU
```

#### –ü–û–¢–û–ö 2: –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏–∑–∞–π–Ω–∞ —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–∞ (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

```
MAIN_MENU
   ‚Üì (create_design)
WHAT_IS_IN_PHOTO
   ‚îú‚Üí (callback: scene_house_exterior)
   ‚îÇ   ‚Üì
   ‚îÇ   EXTERIOR_PROMPT (State: waiting_for_exterior_prompt)
   ‚îÇ   ‚Üì [–¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞: "–°–æ–∑–¥–∞–π —Ñ–∞—Å–∞–¥ –∏–∑ –∫–ª–∏–Ω–∫–µ—Ä–Ω–æ–π –ø–ª–∏—Ç–∫–∏"]
   ‚îÇ   ‚Üì [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è]
   ‚îÇ   ‚Üì
   ‚îÇ   POST_GENERATION (show_continue_editing=True)
   ‚îÇ
   ‚îî‚Üí (callback: scene_plot_exterior)
       ‚Üì
       EXTERIOR_PROMPT (State: waiting_for_exterior_prompt)
       ‚Üì [–¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞: "–î–∏–∑–∞–π–Ω —É—á–∞—Å—Ç–∫–∞/–¥–≤–æ—Ä–∞"]
       ‚Üì [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è]
       ‚Üì
       POST_GENERATION
```

#### –ü–û–¢–û–ö 3: –ü—Ä–æ—Ñ–∏–ª—å –∏ –ü–æ–∫—É–ø–∫–∞

```
MAIN_MENU
   ‚Üì (callback: show_profile)
PROFILE
   ‚îú‚Üí [üí≥ –ö—É–ø–∏—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏] ‚Üí PAYMENT
   ‚îÇ   ‚Üì
   ‚îÇ   PAYMENT
   ‚îÇ   ‚îú‚Üí [10 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π - 190 —Ä—É–±.] ‚Üí (callback: pay_10_190)
   ‚îÇ   ‚îú‚Üí [25 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π - 450 —Ä—É–±.] ‚Üí (callback: pay_25_450)
   ‚îÇ   ‚îî‚Üí [50 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π - 850 —Ä—É–±.] ‚Üí (callback: pay_50_850)
   ‚îÇ   ‚Üì [–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞ –≤ Yookassa]
   ‚îÇ   ‚Üì
   ‚îÇ   PAYMENT_LINK
   ‚îÇ   ‚îú‚Üí [üí∞ –ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ] ‚Üí Yookassa (–≤–Ω–µ—à–Ω–∏–π)
   ‚îÇ   ‚îî‚Üí [‚¨ÖÔ∏è –ù–∞–∑–∞–¥] ‚Üí PROFILE
   ‚îÇ
   ‚îú‚Üí [üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞] ‚Üí SUPPORT
   ‚îÇ
   ‚îú‚Üí [üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞] ‚Üí REFERRAL_PROGRAM
   ‚îÇ
   ‚îî‚Üí [üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é] ‚Üí MAIN_MENU
```

#### –ü–û–¢–û–ö 4: –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å (—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)

```
MAIN_MENU
   ‚Üì (callback: admin_panel) [is_admin –ø—Ä–æ–≤–µ—Ä–∫–∞]
ADMIN_MAIN
   ‚îú‚Üí [üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã] ‚Üí ADMIN_STATS
   ‚îÇ
   ‚îú‚Üí [üîç –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è] ‚Üí ADMIN_SEARCH (State: waiting_for_search)
   ‚îÇ   ‚Üì [–í–≤–æ–¥ ID / username / —Ä–µ—Ñ-–∫–æ–¥]
   ‚îÇ   ‚Üì
   ‚îÇ   ADMIN_USER_CARD (–µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω) –∏–ª–∏ ADMIN_NOT_FOUND (–µ—Å–ª–∏ –Ω–µ—Ç)
   ‚îÇ   ‚Üì
   ‚îÇ   [üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º] ‚Üí BALANCE_MANAGEMENT
   ‚îÇ   ‚Üì
   ‚îÇ   [‚ûï –î–æ–±–∞–≤–∏—Ç—å / ‚ûñ –°–ø–∏—Å–∞—Ç—å / üîÑ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å] ‚Üí BALANCE_ADD/REMOVE/SET
   ‚îÇ   ‚Üì (State: adding_balance / removing_balance / setting_balance)
   ‚îÇ   ‚Üì [–í–≤–æ–¥ —Å—É–º–º—ã]
   ‚îÇ   ‚Üì
   ‚îÇ   BALANCE_CONFIRM
   ‚îÇ   ‚îú‚Üí [‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å] ‚Üí [–æ–ø–µ—Ä–∞—Ü–∏—è –≤ –ë–î] ‚Üí BALANCE_SUCCESS
   ‚îÇ   ‚îî‚Üí [‚ùå –û—Ç–º–µ–Ω–∞] ‚Üí BALANCE_MANAGEMENT
   ‚îÇ
   ‚îú‚Üí [‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏] ‚Üí ADMIN_SETTINGS
   ‚îÇ   ‚îú‚Üí [üí∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–º] ‚Üí (–∫–∞–∫ –≤—ã—à–µ)
   ‚îÇ   ‚îú‚Üí [üì¶ –ü–∞–∫–µ—Ç—ã] ‚Üí PACKAGES_SETTINGS
   ‚îÇ   ‚îî‚Üí [üéÅ –°–∫–∏–¥–∫–∏ –∏ –±–æ–Ω—É—Å—ã] ‚Üí DISCOUNTS_SETTINGS
   ‚îÇ
   ‚îî‚Üí [üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é] ‚Üí MAIN_MENU
```

#### –ü–û–¢–û–ö 5: –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

```
PROFILE
   ‚Üì [üéÅ –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞]
REFERRAL_PROGRAM
   ‚îú‚Üí [üí∞ –í—ã–ø–ª–∞—Ç–∞] ‚Üí REFERRAL_PAYOUT (State: entering_payout_amount)
   ‚îÇ   ‚Üì [–í–≤–æ–¥ —Å—É–º–º—ã]
   ‚îÇ   ‚Üì [–í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞: –∫–∞—Ä—Ç–∞ / YooMoney / –°–ë–ü]
   ‚îÇ   ‚îú‚Üí –ö–∞—Ä—Ç–∞ ‚Üí (State: entering_card_number) ‚Üí [–í–≤–æ–¥ –Ω–æ–º–µ—Ä–∞]
   ‚îÇ   ‚îú‚Üí YooMoney ‚Üí (State: entering_yoomoney) ‚Üí [–í–≤–æ–¥ YooMoney]
   ‚îÇ   ‚îî‚Üí –°–ë–ü ‚Üí (State: entering_phone) ‚Üí [–í–≤–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–∞]
   ‚îÇ   ‚Üì
   ‚îÇ   [–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ + –≤—ã–ø–ª–∞—Ç–∞]
   ‚îÇ
   ‚îú‚Üí [üîÑ –û–±–º–µ–Ω] ‚Üí REFERRAL_EXCHANGE (State: entering_exchange_amount)
   ‚îÇ   ‚Üì [–í–≤–æ–¥ –∫–æ–ª-–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π –¥–ª—è –æ–±–º–µ–Ω–∞]
   ‚îÇ   ‚Üì [–†–∞—Å—á—ë—Ç —Å—É–º–º—ã]
   ‚îÇ   ‚Üì [–í—ã–±–æ—Ä —Å–ø–æ—Å–æ–±–∞ –≤—ã–ø–ª–∞—Ç—ã]
   ‚îÇ
   ‚îî‚Üí [‚¨ÖÔ∏è –ù–∞–∑–∞–¥] ‚Üí PROFILE
```

---

## –≠–¢–ê–ü 8: –ê–ù–ê–õ–ò–ó –ò–ú–ü–û–†–¢–û–í –ò –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô ‚úÖ

### –¢–∞–±–ª–∏—Ü–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ –ø–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º

| –û–±—Ä–∞–±–æ—Ç—á–∏–∫ | –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã | –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç States | –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¢–µ–∫—Å—Ç—ã | –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ù–∞–≤–∏–≥–∞—Ü–∏—é | –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ë–î | –ü—Ä–æ—á–∏–µ |
|---|---|---|---|---|---|---|
| `user_start.py` | `get_main_menu_keyboard()`, `get_profile_keyboard()`, `get_payment_keyboard()`, `get_upload_photo_keyboard()`, `get_what_is_in_photo_keyboard()` | `CreationStates`, `ReferralStates` | `START_TEXT`, `MAIN_MENU_TEXT`, `PROFILE_TEXT`, `UPLOAD_PHOTO_TEXT`, `NO_BALANCE_TEXT` | `edit_menu()`, `show_main_menu()`, `update_menu_after_photo()` | `db.get_user()`, `db.update_balance()`, `db.get_chat_menu()` | `helpers.add_balance_to_text()` |
| `creation.py` | `get_what_is_in_photo_keyboard()`, `get_style_keyboard()`, `get_post_generation_keyboard()`, `get_room_keyboard()` | `CreationStates` | `PHOTO_SAVED_TEXT`, `WHAT_IS_IN_PHOTO_TEXT`, `CHOOSE_ROOM_TEXT`, `CHOOSE_STYLE_TEXT`, `EXTERIOR_HOUSE_PROMPT_TEXT`, `EXTERIOR_PLOT_PROMPT_TEXT`, `ROOM_DESCRIPTION_PROMPT_TEXT`, `NO_BALANCE_TEXT`, `TOO_MANY_PHOTOS_TEXT` | `edit_menu()`, `update_menu_after_photo()` | `db.save_photo()`, `db.update_balance()`, `db.get_user()` | `services.kie_api.generate_image()` (API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏) |
| `payment.py` | `get_payment_keyboard()`, `get_payment_check_keyboard()` | ‚Äî | `PAYMENT_CREATED`, `PAYMENT_SUCCESS_TEXT`, `PAYMENT_ERROR_TEXT` | `edit_menu()` | `db.update_balance()`, `db.add_payment()` | `services.yookassa.create_payment()` (Yookassa API) |
| `admin.py` | `get_admin_main_menu()`, `get_admin_settings_menu()`, `get_back_to_admin_menu()`, `get_balance_main_keyboard()`, `get_balance_confirm_keyboard()`, `get_users_list_keyboard()` | `AdminStates` | `ADMIN_MAIN_TEXT`, `ADMIN_STATS_TEXT`, `ADMIN_USER_CARD_TEXT`, `ADMIN_USER_NOT_FOUND_TEXT`, –≤—Å–µ `BALANCE_*_TEXT` –∏–∑ `admin_texts.py` | `edit_menu()` | `db.get_all_users()`, `db.get_user_by_id()`, `db.search_user()`, `db.add_balance()`, `db.remove_balance()`, `db.set_balance()` | ‚Äî |
| `referral.py` | ‚Äî | `ReferralStates` | ‚Äî | `edit_menu()` | `db.get_referral_stats()`, `db.get_referrals()`, `db.process_payout()` | `services.payment_methods.*` (–¥–ª—è –≤—ã–ø–ª–∞—Ç) |
| `fallback.py` | ‚Äî | ‚Äî | ‚Äî | ‚Äî | ‚Äî | –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ |
| `webhook.py` | ‚Äî | ‚Äî | ‚Äî | ‚Äî | `db.*` | `services.kie_api`, API –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π |

**üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
- **–í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** 7 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º–∏:** 6 (–≤—Å–µ –∫—Ä–æ–º–µ fallback, webhook)
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å FSM:** 5 (user_start, creation, admin, referral, payment)
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å –ë–î:** 6 (–≤—Å–µ –∫—Ä–æ–º–µ fallback)
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å API:** 3 (creation, payment, webhook)

---

## –≠–¢–ê–ü 9: –ê–ù–ê–õ–ò–ó SINGLE MENU PATTERN (SMP) ‚úÖ

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –µ–¥–∏–Ω–æ–≥–æ –º–µ–Ω—é

**–§–∞–π–ª:** `bot/utils/navigation.py`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ ¬´Single Menu Pattern¬ª (SMP) ‚Äî —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–º –º–µ–Ω—é –≤ —á–∞—Ç–µ, –±–µ–∑ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏.

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã SMP

#### 1. **–•—Ä–∞–Ω–∏–ª–∏—â–µ menu_message_id (–ì–ò–ë–†–ò–î–ù–û–ï: FSM + –ë–î)**

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:**
1. **–ü–µ—Ä–≤–∞—è –ª–∏–Ω–∏—è:** FSM state data (–±—ã—Å—Ç—Ä–æ, –≤ –ø–∞–º—è—Ç–∏)
2. **–í—Ç–æ—Ä–∞—è –ª–∏–Ω–∏—è:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö SQLite (–Ω–∞–¥—ë–∂–Ω–æ, survives –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)

```python
# –í FSM state
await state.update_data(menu_message_id=message_id)

# –í –ë–î
await db.save_chat_menu(chat_id, user_id, menu_message_id, screen_code)
```

**–§—É–Ω–∫—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:**
```python
async def edit_menu(...):
    # –®–ê–ì 1: –ü—Ä–æ–≤–µ—Ä—è–µ–º FSM
    data = await state.get_data()
    menu_message_id = data.get('menu_message_id')
    
    # –®–ê–ì 2: –ï—Å–ª–∏ –Ω–µ—Ç –≤ FSM ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ–º –ë–î
    if not menu_message_id:
        menu_info = await db.get_chat_menu(chat_id)
        if menu_info:
            menu_message_id = menu_info['menu_message_id']
            # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤ FSM
            await state.update_data(menu_message_id=menu_message_id)
```

#### 2. **–ö–ª—é—á–µ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è: `edit_menu()`**

**–°–∏–≥–Ω–∞—Ç—É—Ä–∞:**
```python
async def edit_menu(
    callback: CallbackQuery,
    state: FSMContext,
    text: str,
    keyboard: InlineKeyboardMarkup = None,
    parse_mode: str = "Markdown",
    show_balance: bool = True,
    screen_code: str = 'main_menu'
) -> bool:
```

**–õ–æ–≥–∏–∫–∞ (7 —à–∞–≥–æ–≤):**

1. **–ü–æ–ª—É—á–µ–Ω–∏–µ menu_message_id –∏–∑ FSM** (–±—ã—Å—Ç—Ä–æ)
2. **–ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ë–î** (–Ω–∞–¥—ë–∂–Ω–æ)
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ menu_message_id –≤ FSM** (–¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–∞)
4. **–ü–æ–ø—ã—Ç–∫–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   - –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ (—Ç–µ–∫—Å—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è) ‚Üí RETURN True
   - –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è (`message is not modified`) ‚Üí RETURN True (OK)
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ (–º–µ–Ω—é —É–¥–∞–ª–µ–Ω–æ, –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞) ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —à–∞–≥—É 6
5. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ meta-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –ë–î:** `screen_code` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
6. **FALLBACK: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è** (–µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ)
   - –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä–æ–µ –º–µ–Ω—é –∏–∑ –ë–î
   - –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `callback.message.answer()`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–≤—ã–π ID
7. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ FSM + –ë–î –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ**

**–í–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:**
- `True` ‚Äî —É—Å–ø–µ—à–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- `False` ‚Äî —Å–æ–∑–¥–∞–Ω–æ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (fallback)

#### 3. **–§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é: `show_main_menu()`**

**–õ–æ–≥–∏–∫–∞:**
```python
async def show_main_menu(callback: CallbackQuery, state: FSMContext, admins: list[int]):
    # –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º menu_message_id –ü–ï–†–ï–î —Å–±—Ä–æ—Å–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è
    data = await state.get_data()
    menu_message_id = data.get('menu_message_id')
    
    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û —Å–æ—Å—Ç–æ—è–Ω–∏–µ FSM (–ù–ï state.clear()!)
    await state.set_state(None)
    
    # –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú menu_message_id –°–†–ê–ó–£ –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞
    if menu_message_id:
        await state.update_data(menu_message_id=menu_message_id)
    
    # –í—ã–∑—ã–≤–∞–µ–º edit_menu() –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–Ω—é
    await edit_menu(
        callback=callback,
        state=state,
        text=START_TEXT,
        keyboard=get_main_menu_keyboard(is_admin=user_id in admins),
        screen_code='main_menu'
    )
```

**–ö–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç:** –°–±—Ä–æ—Å FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è (`.set_state(None)`) –ù–ï –¥–æ–ª–∂–µ–Ω –æ—á–∏—â–∞—Ç—å `menu_message_id`, –∏–Ω–∞—á–µ –º–µ–Ω—é –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è. –ü–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `state.update_data()` –≤–º–µ—Å—Ç–æ `state.clear()`.

#### 4. **–§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ñ–æ—Ç–æ: `update_menu_after_photo()`**

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:** –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ (message handler, –Ω–µ callback handler)

**–õ–æ–≥–∏–∫–∞:** –ê–Ω–∞–ª–æ–≥–∏—á–Ω–∞ `edit_menu()`, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å Message –æ–±—ä–µ–∫—Ç–æ–º –≤–º–µ—Å—Ç–æ CallbackQuery.

#### 5. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ FSM state —Ç–µ—Ä—è–µ—Ç—Å—è (–æ–Ω –≤ –ø–∞–º—è—Ç–∏), –Ω–æ –º–µ–Ω—é –æ—Å—Ç–∞—ë—Ç—Å—è –≤ Telegram.

**–†–µ—à–µ–Ω–∏–µ:**
- –í—Å–µ menu_message_id'—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î SQLite
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º callback'–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  1. FSM state –ø—É—Å—Ç
  2. `edit_menu()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ë–î
  3. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç menu_message_id –∏–∑ –ë–î
  4. –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤ FSM (–¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–∑–∞)
  5. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ –º–µ–Ω—é

**–¢–∞–±–ª–∏—Ü–∞ –ë–î: `chat_menus`**
```sql
CREATE TABLE chat_menus (
    chat_id INTEGER,
    user_id INTEGER,
    menu_message_id INTEGER,
    screen_code TEXT,  -- current screen code
    created_at TIMESTAMP,
    updated_at TIMESTAMP
)
```

#### 6. **–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –º–µ–Ω—é**

**–§—É–Ω–∫—Ü–∏—è:** `db.delete_old_menu_if_exists(chat_id, bot)`

**–õ–æ–≥–∏–∫–∞:**
- –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ä—ã–π menu_message_id –∏–∑ –ë–î
- –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —É–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram API
- –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ ‚Üí —É–¥–∞–ª–∏—Ç—å –∏–∑ –ë–î
- –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ (—É–∂–µ —É–¥–∞–ª–µ–Ω–æ, –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞) ‚Üí –ø—Ä–æ—Å—Ç–æ —É–¥–∞–ª–∏—Ç—å –∏–∑ –ë–î

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ SMP

| –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|
| **–ß–∏—Å—Ç–æ—Ç–∞ —á–∞—Ç–∞** | –ù–µ—Ç —Å–ø–∞–º–∞ –∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –º–µ–Ω—é |
| **–ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è** | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (instant) –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è + —Å–æ–∑–¥–∞–Ω–∏—è |
| **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞** | menu_message_id –≤ –ë–î ‚Üí –º–µ–Ω—é –Ω–µ —Ç–µ—Ä—è–µ—Ç—Å—è |
| **–ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** | FSM –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏ + –ë–î –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ |
| **Graceful fallback** | –ï—Å–ª–∏ –º–µ–Ω—é —É–¥–∞–ª–µ–Ω–æ ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤–æ–µ |

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ

#### –ü—Ä–∏–º–µ—Ä 1: –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å

```python
@router.callback_query(F.data == "show_profile")
async def show_profile(callback: CallbackQuery, state: FSMContext):
    user = await db.get_user(callback.from_user.id)
    text = PROFILE_TEXT.format(balance=user.balance, reg_date=user.reg_date)
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º edit_menu() –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –º–µ–Ω—é
    await edit_menu(
        callback=callback,
        state=state,
        text=text,
        keyboard=get_profile_keyboard(),
        screen_code='profile'  # –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —ç–∫—Ä–∞–Ω
    )
```

#### –ü—Ä–∏–º–µ—Ä 2: –í–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (—Å–æ —Å–±—Ä–æ—Å–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è)

```python
@router.callback_query(F.data == "main_menu")
async def back_to_main_menu(callback: CallbackQuery, state: FSMContext, admins: list[int]):
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º show_main_menu() –∏–∑ navigation.py
    # –û–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ menu_message_id
    await show_main_menu(callback, state, admins)
```

#### –ü—Ä–∏–º–µ—Ä 3: –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ (message handler)

```python
@router.message(StateFilter(CreationStates.waiting_for_photo))
async def photo_handler(message: Message, state: FSMContext):
    # –°–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Ñ–æ—Ç–æ
    await state.update_data(photo_id=message.photo[-1].file_id)
    
    # –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –Ω–æ–≤—ã–π —ç–∫—Ä–∞–Ω
    await state.set_state(CreationStates.what_is_in_photo)
    
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º update_menu_after_photo() –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–Ω—é
    await update_menu_after_photo(
        message=message,
        state=state,
        text=WHAT_IS_IN_PHOTO_TEXT,
        keyboard=get_what_is_in_photo_keyboard()
    )
```

---

## –ò–¢–û–ì–û–í–ê–Ø –¢–ê–ë–õ–ò–¶–ê –ò–ù–¢–ï–ì–†–ê–¶–ò–ò

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –§—É–Ω–∫—Ü–∏–∏/–ö–ª–∞—Å—Å—ã | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|---|---|
| **FSM** | `bot/states/fsm.py` | `CreationStates`, `AdminStates`, `ReferralStates` | 17 —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Ç–æ–∫–æ–º –¥–∏–∞–ª–æ–≥–∞ |
| **–¢–µ–∫—Å—Ç—ã** | `bot/utils/texts.py`, `bot/utils/admin_texts.py` | 37 —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–Ω—Å—Ç–∞–Ω—Ç | –°–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–æ–≤ |
| **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã** | `bot/keyboards/inline.py`, `bot/keyboards/admin_kb.py` | 18 —Ñ—É–Ω–∫—Ü–∏–π | –ö–Ω–æ–ø–∫–∏ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è |
| **–ù–∞–≤–∏–≥–∞—Ü–∏—è (SMP)** | `bot/utils/navigation.py` | `edit_menu()`, `show_main_menu()`, `update_menu_after_photo()` | –ï–¥–∏–Ω–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–µ –º–µ–Ω—é |
| **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** | `bot/handlers/*.py` | 50+ —Ñ—É–Ω–∫—Ü–∏–π –≤ 7 —Ñ–∞–π–ª–∞—Ö | –õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ callback'–æ–≤ |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | `bot/database/db.py` | –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –º–µ–Ω—é, –ø–ª–∞—Ç–µ–∂–µ–π |
| **–°–µ—Ä–≤–∏—Å—ã** | `bot/services/` | API –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –ø–ª–∞—Ç–µ–∂–µ–π | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ |

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï ‚úÖ

**–ú–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ InteriorBot –∑–∞–≤–µ—Ä—à—ë–Ω!**

### –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:

1. ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –•–æ—Ä–æ—à–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ —Å —á—ë—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –ø–∞–ø–æ–∫
2. ‚úÖ **FSM:** 17 —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è 3 –æ—Å–Ω–æ–≤–Ω—ã–º–∏ –ø–æ—Ç–æ–∫–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –∞–¥–º–∏–Ω, —Ä–µ—Ñ–µ—Ä–∞–ª—ã)
3. ‚úÖ **Single Menu Pattern (SMP):** –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≥–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ (FSM + –ë–î) –¥–ª—è –Ω–∞–¥—ë–∂–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ–Ω—é
4. ‚úÖ **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã:** 18 —Ñ—É–Ω–∫—Ü–∏–π —Å 37+ –∫–Ω–æ–ø–∫–∞–º–∏, –≤–∫–ª—é—á–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ
5. ‚úÖ **–ü–æ—Ç–æ–∫–∏:** 5 –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤ + –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
6. ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:** –ü–ª–∞–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É handlers, keyboards, texts –∏ navigation
7. ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** Graceful fallback'–∏ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ –º–µ–Ω—é, –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –±–∞–ª–∞–Ω—Å–∞ –∏ —Ç.–¥.

### –ù–æ–≤–æ–µ –≤ v1 (2025-12-08):

- ‚ú® –≠–∫—Ä–∞–Ω "–ß—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ" (what_is_in_photo) –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–Ω—Ç–µ—Ä—å–µ—Ä–∞/—ç–∫—Å—Ç–µ—Ä—å–µ—Ä–∞
- ‚ú® –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è —ç–∫—Å—Ç–µ—Ä—å–µ—Ä–∞
- ‚ú® –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è "–¥—Ä—É–≥–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è"
- ‚ú® –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞

---

**–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω:** 24.12.2025 09:15  
**–í–µ—Ä—Å–∏—è:** SCREENS_MAP_V1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

